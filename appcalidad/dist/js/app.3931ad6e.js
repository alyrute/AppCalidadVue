(function(){"use strict";var o={9898:function(o,i,t){var r=t(3751),e=t(641);function a(o,i,t,r,a,n){const s=(0,e.g2)("router-view");return(0,e.uX)(),(0,e.Wv)(s)}var n={name:"App"},s=t(6262);const c=(0,s.A)(n,[["render",a]]);var l=c,d=t(5220),u=t(33),h=t.p+"img/logoMC.f25893a2.png";const p={id:"app"},g={class:"input-section"},f={key:0,class:"loading"},k={key:1,class:"error"},m={key:0,class:"producto-detalles"},v={key:1,class:"historial-cajas"},L={class:"historial-grid"},C={key:2,class:"popup"};function E(o,i,t,a,n,s){return(0,e.uX)(),(0,e.CE)("div",p,[i[16]||(i[16]=(0,e.Lk)("header",{class:"header-grid"},[(0,e.Lk)("img",{src:h,alt:"Logo de la empresa",class:"logo",width:"200"}),(0,e.Lk)("h1",{class:"titulo"},"Registro de Lectura de Calidad")],-1)),(0,e.Lk)("main",null,[(0,e.Lk)("section",g,[(0,e.bo)((0,e.Lk)("input",{ref:"codigoInput",type:"text","onUpdate:modelValue":i[0]||(i[0]=o=>n.codigo=o),onKeyup:i[1]||(i[1]=(0,r.jR)(((...o)=>s.registrarLectura&&s.registrarLectura(...o)),["enter"])),placeholder:"Escanea el código OF","aria-label":"Código OF"},null,544),[[r.Jo,n.codigo]]),n.loading?((0,e.uX)(),(0,e.CE)("div",f,"Cargando...")):(0,e.Q3)("",!0),n.error?((0,e.uX)(),(0,e.CE)("div",k,[(0,e.Lk)("p",null,(0,u.v_)(n.error),1)])):(0,e.Q3)("",!0)]),n.producto?((0,e.uX)(),(0,e.CE)("section",m,[i[7]||(i[7]=(0,e.Lk)("h2",null,"Detalles del Producto",-1)),(0,e.Lk)("p",null,[i[2]||(i[2]=(0,e.Lk)("strong",null,"Código OF:",-1)),(0,e.eW)(" "+(0,u.v_)(n.producto.codigoof),1)]),(0,e.Lk)("p",null,[i[3]||(i[3]=(0,e.Lk)("strong",null,"Código Producto:",-1)),(0,e.eW)(" "+(0,u.v_)(n.producto.codigoproducto),1)]),(0,e.Lk)("p",null,[i[4]||(i[4]=(0,e.Lk)("strong",null,"Descripción:",-1)),(0,e.eW)(" "+(0,u.v_)(n.producto.descripcion),1)]),(0,e.Lk)("p",null,[i[5]||(i[5]=(0,e.eW)("Largo: ")),(0,e.Lk)("strong",null,(0,u.v_)(n.producto.largo),1)]),(0,e.Lk)("p",null,[i[6]||(i[6]=(0,e.eW)("Ancho: ")),(0,e.Lk)("strong",null,(0,u.v_)(n.producto.ancho),1)])])):(0,e.Q3)("",!0),n.historial.length>0?((0,e.uX)(),(0,e.CE)("section",v,[i[14]||(i[14]=(0,e.Lk)("h2",null,"Últimos Códigos OF Leídos",-1)),(0,e.Lk)("div",L,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(n.historial.filter((o=>o.codigoof!==n.producto?.codigoof)),((o,t)=>((0,e.uX)(),(0,e.CE)("div",{key:t,class:"codigo-card"},[(0,e.Lk)("p",null,[i[8]||(i[8]=(0,e.eW)("Código OF: ")),(0,e.Lk)("strong",null,(0,u.v_)(o.codigoof),1)]),(0,e.Lk)("p",null,[i[9]||(i[9]=(0,e.eW)("Código Producto: ")),(0,e.Lk)("strong",null,(0,u.v_)(o.codigoproducto),1)]),(0,e.Lk)("p",null,[i[10]||(i[10]=(0,e.eW)("Descripción: ")),(0,e.Lk)("strong",null,(0,u.v_)(o.descripcion),1)]),(0,e.Lk)("p",null,[i[11]||(i[11]=(0,e.eW)("Largo: ")),(0,e.Lk)("strong",null,(0,u.v_)(o.largo),1)]),(0,e.Lk)("p",null,[i[12]||(i[12]=(0,e.eW)("Ancho: ")),(0,e.Lk)("strong",null,(0,u.v_)(o.ancho),1)]),(0,e.Lk)("p",null,[i[13]||(i[13]=(0,e.eW)("Fecha de Creación: ")),(0,e.Lk)("strong",null,(0,u.v_)(o.fechacreacion),1)])])))),128))])])):(0,e.Q3)("",!0),n.showConfirmPopup?((0,e.uX)(),(0,e.CE)("div",C,i[15]||(i[15]=[(0,e.Lk)("div",{class:"popup-content"},[(0,e.Lk)("p",null,"Este código OF ya ha sido leído por calidad."),(0,e.Lk)("p",null,"¿Quiere sacar de la línea este producto?"),(0,e.Lk)("p",null,'Escanee "Sí" para sacar o "No" para cancelar.'),(0,e.Lk)("div",{class:"barcode-container"},[(0,e.Lk)("svg",{id:"barcodeSi"}),(0,e.Lk)("svg",{id:"barcodeNo"})])],-1)]))):(0,e.Q3)("",!0)])])}var y=t(6129),w=t.n(y),b={data(){return{codigo:"",producto:null,historial:[],error:null,loading:!1,socket:null,showConfirmPopup:!1,productoParaEliminar:null,isConfirming:!1}},created(){this.socket=new WebSocket("ws://192.168.1.33:8080/ws"),this.socket.onmessage=o=>{const i=JSON.parse(o.data);if("update"===i.type&&(!this.producto||this.producto.codigoof!==i.producto.codigoof)){const o=this.historial.some((o=>o.codigoof===i.producto.codigoof));o||(this.historial.unshift(i.producto),this.historial.length>4&&this.historial.pop())}}},mounted(){window.addEventListener("keyup",this.detectarEscaneo)},beforeUnmount(){window.removeEventListener("keyup",this.detectarEscaneo)},methods:{async registrarLectura(){this.error=null,this.loading=!0;try{const o=this.codigo.toUpperCase().trim();if("SI"===o)return void await this.confirmarEliminacion();if("NO"===o)return void this.cancelarEliminacion();if(!this.codigo)throw new Error("Por favor ingrese un código OF válido.");const i=await fetch(`http://127.0.0.1:8000/productos/${this.codigo}`);if(!i.ok)throw new Error("Producto no encontrado.");const t=await i.json();if(t.lecturacalidadactiva)return this.productoParaEliminar=t,this.showConfirmPopup=!0,this.codigo="",this.$nextTick((()=>this.generateBarcodes())),void(this.loading=!1);const r=await fetch(`http://127.0.0.1:8000/productos/${this.codigo}/calidad`,{method:"PUT",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error("No se pudo registrar la lectura.");if(this.producto&&this.producto.codigoof!==t.codigoof){const o=this.historial.some((o=>o.codigoof===this.producto.codigoof));o||(this.historial.unshift(this.producto),this.historial.length>4&&this.historial.pop())}this.producto=t,this.codigo="",this.socket.send(JSON.stringify({type:"update",producto:this.producto}))}catch(o){this.error=o.message}finally{this.loading=!1}},detectarEscaneo(){if(!this.showConfirmPopup)return;const o=this.codigo.toUpperCase().trim();"SI"===o?this.confirmarEliminacion():"NO"===o&&this.cancelarEliminacion()},generateBarcodes(){w()("#barcodeSi","SI",{format:"CODE128",lineColor:"#000",width:2,height:60,displayValue:!0}),w()("#barcodeNo","NO",{format:"CODE128",lineColor:"#000",width:2,height:60,displayValue:!0})},async confirmarEliminacion(){if(!this.isConfirming){this.isConfirming=!0;try{const o=await fetch(`http://127.0.0.1:8000/productos/${this.productoParaEliminar.codigoof}/reset`,{method:"PUT",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("No se pudo eliminar el producto.");this.historial=this.historial.filter((o=>o.codigoof!==this.productoParaEliminar.codigoof)),this.producto?.codigoof===this.productoParaEliminar.codigoof&&(this.producto=null),this.socket.send(JSON.stringify({type:"delete",codigoof:this.productoParaEliminar.codigoof})),this.productoParaEliminar=null,this.showConfirmPopup=!1,this.codigo=""}catch(o){this.error=o.message}finally{this.isConfirming=!1}}},cancelarEliminacion(){this.productoParaEliminar=null,this.showConfirmPopup=!1,this.codigo="",this.$refs.codigoInput.focus()}}};const O=(0,s.A)(b,[["render",E],["__scopeId","data-v-3f30ecac"]]);var P=O;const _={id:"app"},W={class:"input-section"},j={key:0,class:"loading"},F={key:1,class:"error"},X={key:0,class:"historial-cajas"},N={class:"historial-grid"};function S(o,i,t,a,n,s){const c=(0,e.g2)("vue-barcode");return(0,e.uX)(),(0,e.CE)("div",_,[i[7]||(i[7]=(0,e.Lk)("header",{class:"header-grid"},[(0,e.Lk)("img",{src:h,alt:"Logo de la empresa",class:"logo",width:"200"}),(0,e.Lk)("h1",{class:"titulo"},"Registro de Lectura de Empaquetado")],-1)),(0,e.Lk)("main",null,[(0,e.Lk)("section",W,[(0,e.bo)((0,e.Lk)("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=o=>n.codigo=o),onKeyup:i[1]||(i[1]=(0,r.jR)(((...o)=>s.registrarLectura&&s.registrarLectura(...o)),["enter"])),placeholder:"Escanea el código OF","aria-label":"Código OF"},null,544),[[r.Jo,n.codigo]]),n.loading?((0,e.uX)(),(0,e.CE)("div",j,"Cargando...")):(0,e.Q3)("",!0),n.error?((0,e.uX)(),(0,e.CE)("div",F,[(0,e.Lk)("p",null,(0,u.v_)(n.error),1)])):(0,e.Q3)("",!0)]),s.historialFiltrado.length>0?((0,e.uX)(),(0,e.CE)("section",X,[i[6]||(i[6]=(0,e.Lk)("h2",null,"Códigos OF Leídos por Calidad",-1)),(0,e.Lk)("div",N,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(s.historialFiltrado.slice(0,10),((o,t)=>((0,e.uX)(),(0,e.CE)("div",{key:t,class:(0,u.C4)(["codigo-card",{"madera-card":/(cajón madera maciza|hibrido madera \+ cartón|pallet box|cartón propio)/i.test(o.nombre_embalaje||"")}])},[(0,e.Lk)("p",null,[i[2]||(i[2]=(0,e.eW)("Código OF: ")),(0,e.Lk)("strong",null,(0,u.v_)(o.codigoof),1)]),(0,e.Lk)("p",null,[i[3]||(i[3]=(0,e.eW)("Código Producto: ")),(0,e.Lk)("strong",null,(0,u.v_)(o.codigoproducto),1)]),(0,e.Lk)("p",null,[i[4]||(i[4]=(0,e.eW)("Descripción: ")),(0,e.Lk)("strong",null,(0,u.v_)(o.descripcion),1)]),(0,e.Lk)("p",null,[i[5]||(i[5]=(0,e.eW)("Tipo Embalaje: ")),(0,e.Lk)("strong",null,(0,u.v_)(o.nombre_embalaje||"N/A"),1)]),"CARTÓN PANOTEC"===o.nombre_embalaje?((0,e.uX)(),(0,e.Wv)(c,{key:0,value:o.codigopanotec},null,8,["value"])):(0,e.Q3)("",!0)],2)))),128))])])):(0,e.Q3)("",!0)])])}var A=t(5851),T={components:{VueBarcode:A.A},data(){return{codigo:"",historial:[],socket:null,loading:!1,error:null}},computed:{historialFiltrado(){return this.historial.filter((o=>o.lecturacalidadactiva&&!o.lecturaempaquetadoactiva)).reverse()}},methods:{async registrarLectura(){this.loading=!0,this.error=null;try{const o=`http://127.0.0.1:8000/productos/${this.codigo}/empaquetado`,i={method:"PUT"},t=await fetch(o,i);if(!t.ok)throw new Error("Error al registrar la lectura de empaquetado");this.historial=this.historial.filter((o=>o.codigoof!==this.codigo))}catch(o){this.error=o.message}finally{this.loading=!1,this.codigo=""}}},mounted(){this.$nextTick((()=>{this.$refs.inputCodigo&&this.$refs.inputCodigo.focus()}))},created(){this.socket=new WebSocket("ws://192.168.1.33:8080/ws"),this.socket.onopen=()=>{console.log("Conexión WebSocket establecida")},this.socket.onerror=o=>{console.error("Error en WebSocket:",o)},this.socket.onmessage=o=>{const i=JSON.parse(o.data);if(console.log("Mensaje recibido del WebSocket:",i),"update"===i.type){const o=this.historial.find((o=>o.codigoof===i.producto.codigoof));o||(this.historial.unshift(i.producto),this.historial.length>10&&this.historial.pop())}else"delete"===i.type&&(console.log("Producto a eliminar:",i.codigoof),this.historial=this.historial.filter((o=>o.codigoof!==i.codigoof)),console.log("Producto eliminado del historial:",i.codigoof))}}};const x=(0,s.A)(T,[["render",S],["__scopeId","data-v-e676ec9c"]]);var Q=x;function I(o,i,t,r,a,n){return(0,e.uX)(),(0,e.CE)("div",null,i[0]||(i[0]=[(0,e.Lk)("h1",null,"Bienvenido a Calidad - Empaquetado",-1),(0,e.Lk)("h1",null,"MCBATH",-1)]))}var $={name:"HomePage"};const q=(0,s.A)($,[["render",I]]);var U=q;const D=[{path:"/",name:"HomePage",component:U},{path:"/calidad",name:"Calidad",component:P},{path:"/empaquetado",name:"Empaquetado",component:Q}],J=(0,d.aE)({history:(0,d.LA)(),routes:D});var B=J;(0,r.Ef)(l).use(B).mount("#app")}},i={};function t(r){var e=i[r];if(void 0!==e)return e.exports;var a=i[r]={exports:{}};return o[r](a,a.exports,t),a.exports}t.m=o,function(){var o=[];t.O=function(i,r,e,a){if(!r){var n=1/0;for(d=0;d<o.length;d++){r=o[d][0],e=o[d][1],a=o[d][2];for(var s=!0,c=0;c<r.length;c++)(!1&a||n>=a)&&Object.keys(t.O).every((function(o){return t.O[o](r[c])}))?r.splice(c--,1):(s=!1,a<n&&(n=a));if(s){o.splice(d--,1);var l=e();void 0!==l&&(i=l)}}return i}a=a||0;for(var d=o.length;d>0&&o[d-1][2]>a;d--)o[d]=o[d-1];o[d]=[r,e,a]}}(),function(){t.n=function(o){var i=o&&o.__esModule?function(){return o["default"]}:function(){return o};return t.d(i,{a:i}),i}}(),function(){t.d=function(o,i){for(var r in i)t.o(i,r)&&!t.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:i[r]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(o){if("object"===typeof window)return window}}()}(),function(){t.o=function(o,i){return Object.prototype.hasOwnProperty.call(o,i)}}(),function(){t.p="/empaquetado/"}(),function(){var o={524:0};t.O.j=function(i){return 0===o[i]};var i=function(i,r){var e,a,n=r[0],s=r[1],c=r[2],l=0;if(n.some((function(i){return 0!==o[i]}))){for(e in s)t.o(s,e)&&(t.m[e]=s[e]);if(c)var d=c(t)}for(i&&i(r);l<n.length;l++)a=n[l],t.o(o,a)&&o[a]&&o[a][0](),o[a]=0;return t.O(d)},r=self["webpackChunkappcalidad"]=self["webpackChunkappcalidad"]||[];r.forEach(i.bind(null,0)),r.push=i.bind(null,r.push.bind(r))}();var r=t.O(void 0,[504],(function(){return t(9898)}));r=t.O(r)})();
//# sourceMappingURL=app.3931ad6e.js.map