(function(){"use strict";var o={4600:function(o,t,r){var a=r(3751),i=r(641);function e(o,t,r,a,e,n){const l=(0,i.g2)("router-view");return(0,i.uX)(),(0,i.Wv)(l)}var n={name:"App"},l=r(6262);const s=(0,l.A)(n,[["render",e]]);var c=s,u=r(5220),d=r(33),p=r.p+"img/logoMC.f25893a2.png";const h={id:"app"},g={class:"input-section"},m={key:0,class:"loading"},f={key:1,class:"error"},k={key:0,class:"producto-detalles"},v={key:1,class:"historial-cajas"},L={class:"historial-grid"},y={key:2,class:"popup"};function E(o,t,r,e,n,l){return(0,i.uX)(),(0,i.CE)("div",h,[t[16]||(t[16]=(0,i.Lk)("header",{class:"header-grid"},[(0,i.Lk)("img",{src:p,alt:"Logo de la empresa",class:"logo",width:"200"}),(0,i.Lk)("h1",{class:"titulo"},"Registro de Lectura de Calidad")],-1)),(0,i.Lk)("main",null,[(0,i.Lk)("section",g,[(0,i.bo)((0,i.Lk)("input",{ref:"codigoInput",type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>n.codigo=o),onKeyup:t[1]||(t[1]=(0,a.jR)(((...o)=>l.registrarLectura&&l.registrarLectura(...o)),["enter"])),placeholder:"Escanea la matrícula","aria-label":"Matrícula"},null,544),[[a.Jo,n.codigo]]),n.loading?((0,i.uX)(),(0,i.CE)("div",m,"Cargando...")):(0,i.Q3)("",!0),n.error?((0,i.uX)(),(0,i.CE)("div",f,[(0,i.Lk)("p",null,(0,d.v_)(n.error),1)])):(0,i.Q3)("",!0)]),n.producto?((0,i.uX)(),(0,i.CE)("section",k,[t[7]||(t[7]=(0,i.Lk)("h2",null,"Detalles del Producto",-1)),(0,i.Lk)("p",null,[t[2]||(t[2]=(0,i.Lk)("strong",null,"Matrícula:",-1)),(0,i.eW)(" "+(0,d.v_)(n.producto.matricula),1)]),(0,i.Lk)("p",null,[t[3]||(t[3]=(0,i.Lk)("strong",null,"Código Producto:",-1)),(0,i.eW)(" "+(0,d.v_)(n.producto.codigoproducto),1)]),(0,i.Lk)("p",null,[t[4]||(t[4]=(0,i.Lk)("strong",null,"Descripción:",-1)),(0,i.eW)(" "+(0,d.v_)(n.producto.descripcion),1)]),(0,i.Lk)("p",null,[t[5]||(t[5]=(0,i.eW)("Largo: ")),(0,i.Lk)("strong",null,(0,d.v_)(n.producto.largo),1)]),(0,i.Lk)("p",null,[t[6]||(t[6]=(0,i.eW)("Ancho: ")),(0,i.Lk)("strong",null,(0,d.v_)(n.producto.ancho),1)])])):(0,i.Q3)("",!0),n.historial.length>0?((0,i.uX)(),(0,i.CE)("section",v,[t[14]||(t[14]=(0,i.Lk)("h2",null,"Últimas Matrículas Leídas",-1)),(0,i.Lk)("div",L,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.historial.filter((o=>o.matricula!==n.producto?.matricula)),((o,r)=>((0,i.uX)(),(0,i.CE)("div",{key:r,class:"codigo-card"},[(0,i.Lk)("p",null,[t[8]||(t[8]=(0,i.eW)("Matrícula: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.matricula),1)]),(0,i.Lk)("p",null,[t[9]||(t[9]=(0,i.eW)("Código Producto: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.codigoproducto),1)]),(0,i.Lk)("p",null,[t[10]||(t[10]=(0,i.eW)("Descripción: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.descripcion),1)]),(0,i.Lk)("p",null,[t[11]||(t[11]=(0,i.eW)("Largo: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.largo),1)]),(0,i.Lk)("p",null,[t[12]||(t[12]=(0,i.eW)("Ancho: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.ancho),1)]),(0,i.Lk)("p",null,[t[13]||(t[13]=(0,i.eW)("Fecha de Creación: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.fechacreacion),1)])])))),128))])])):(0,i.Q3)("",!0),n.showConfirmPopup?((0,i.uX)(),(0,i.CE)("div",y,t[15]||(t[15]=[(0,i.Lk)("div",{class:"popup-content"},[(0,i.Lk)("p",null,"Esta matrícula ya ha sido leída por calidad."),(0,i.Lk)("p",null,"¿Quiere sacar de la línea este producto?"),(0,i.Lk)("p",null,'Escanee "Sí" para sacar o "No" para cancelar.'),(0,i.Lk)("div",{class:"barcode-container"},[(0,i.Lk)("svg",{id:"barcodeSi"}),(0,i.Lk)("svg",{id:"barcodeNo"})])],-1)]))):(0,i.Q3)("",!0)])])}var w=r(6129),C=r.n(w),b={data(){return{codigo:"",producto:null,historial:[],error:null,loading:!1,socket:null,showConfirmPopup:!1,productoParaEliminar:null,isConfirming:!1}},created(){this.socket=new WebSocket("ws://192.168.1.33:8081/ws"),this.socket.onmessage=o=>{const t=JSON.parse(o.data);if("update"===t.type&&(!this.producto||this.producto.matricula!==t.producto.matricula)){const o=this.historial.some((o=>o.matricula===t.producto.matricula));o||(this.historial.unshift(t.producto),this.historial.length>4&&this.historial.pop())}}},mounted(){window.addEventListener("keyup",this.detectarEscaneo)},beforeUnmount(){window.removeEventListener("keyup",this.detectarEscaneo)},methods:{async registrarLectura(){this.error=null,this.loading=!0;try{const o=this.codigo.toUpperCase().trim();if("SI"===o)return void await this.confirmarEliminacion();if("NO"===o)return void this.cancelarEliminacion();if(!this.codigo)throw new Error("Por favor ingrese una matrícula válida.");const t=await fetch(`http://192.168.1.33:8081/productos/${this.codigo}`);if(!t.ok)throw new Error("Producto no encontrado.");const r=await t.json();if(r.lecturacalidadactiva)return this.productoParaEliminar=r,this.showConfirmPopup=!0,this.codigo="",this.$nextTick((()=>this.generateBarcodes())),void(this.loading=!1);const a=await fetch(`http://192.168.1.33:8081/productos/${this.codigo}/calidad`,{method:"PUT",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("No se pudo registrar la lectura.");if(this.producto&&this.producto.matricula!==r.matricula){const o=this.historial.some((o=>o.matricula===this.producto.matricula));o||(this.historial.unshift(this.producto),this.historial.length>4&&this.historial.pop())}this.producto=r,this.codigo="",this.socket.send(JSON.stringify({type:"update",producto:this.producto}))}catch(o){this.error=o.message}finally{this.loading=!1}},detectarEscaneo(){if(!this.showConfirmPopup)return;const o=this.codigo.toUpperCase().trim();"SI"===o?this.confirmarEliminacion():"NO"===o&&this.cancelarEliminacion()},generateBarcodes(){C()("#barcodeSi","SI",{format:"CODE128",lineColor:"#000",width:2,height:60,displayValue:!0}),C()("#barcodeNo","NO",{format:"CODE128",lineColor:"#000",width:2,height:60,displayValue:!0})},async confirmarEliminacion(){if(!this.isConfirming){this.isConfirming=!0;try{const o=await fetch(`http://192.168.1.33:8081/productos/${this.productoParaEliminar.matricula}/reset`,{method:"PUT",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("No se pudo eliminar el producto.");this.historial=this.historial.filter((o=>o.matricula!==this.productoParaEliminar.matricula)),this.producto?.matricula===this.productoParaEliminar.matricula&&(this.producto=null),this.socket.send(JSON.stringify({type:"delete",matricula:this.productoParaEliminar.matricula})),this.productoParaEliminar=null,this.showConfirmPopup=!1,this.codigo=""}catch(o){this.error=o.message}finally{this.isConfirming=!1}}},cancelarEliminacion(){this.productoParaEliminar=null,this.showConfirmPopup=!1,this.codigo="",this.$refs.codigoInput.focus()}}};const P=(0,l.A)(b,[["render",E],["__scopeId","data-v-57acd9c4"]]);var _=P;const O={id:"app"},W={class:"input-section"},S={key:0,class:"loading"},j={key:1,class:"error"},X={key:0,class:"historial-cajas"},M={class:"historial-grid"};function N(o,t,r,e,n,l){const s=(0,i.g2)("vue-barcode");return(0,i.uX)(),(0,i.CE)("div",O,[t[8]||(t[8]=(0,i.Lk)("header",{class:"header-grid"},[(0,i.Lk)("img",{src:p,alt:"Logo de la empresa",class:"logo",width:"200"}),(0,i.Lk)("h1",{class:"titulo"},"Registro de Lectura de Empaquetado")],-1)),(0,i.Lk)("main",null,[(0,i.Lk)("section",W,[(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>n.codigo=o),onKeyup:t[1]||(t[1]=(0,a.jR)(((...o)=>l.registrarLectura&&l.registrarLectura(...o)),["enter"])),placeholder:"Escanea la matrícula","aria-label":"Matrícula"},null,544),[[a.Jo,n.codigo]]),n.loading?((0,i.uX)(),(0,i.CE)("div",S,"Cargando...")):(0,i.Q3)("",!0),n.error?((0,i.uX)(),(0,i.CE)("div",j,[(0,i.Lk)("p",null,(0,d.v_)(n.error),1)])):(0,i.Q3)("",!0)]),l.historialFiltrado.length>0?((0,i.uX)(),(0,i.CE)("section",X,[t[7]||(t[7]=(0,i.Lk)("h2",null,"Matrículas Leídas por Calidad",-1)),(0,i.Lk)("div",M,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(l.historialFiltrado.slice(0,10),((o,r)=>((0,i.uX)(),(0,i.CE)("div",{key:r,class:"codigo-card"},[(0,i.Lk)("p",null,[t[2]||(t[2]=(0,i.eW)("Matrícula: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.matricula),1)]),(0,i.Lk)("p",null,[t[3]||(t[3]=(0,i.eW)("Código Producto: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.codigoproducto),1)]),(0,i.Lk)("p",null,[t[4]||(t[4]=(0,i.eW)("Descripción: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.descripcion),1)]),(0,i.Lk)("p",null,[t[5]||(t[5]=(0,i.eW)("Largo: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.largo),1),t[6]||(t[6]=(0,i.eW)(" || Ancho: ")),(0,i.Lk)("strong",null,(0,d.v_)(o.ancho),1)]),(0,i.bF)(s,{value:o.codigopanotec},null,8,["value"])])))),128))])])):(0,i.Q3)("",!0)])])}var A=r(5851),D={components:{VueBarcode:A.A},data(){return{codigo:"",historial:[],socket:null,loading:!1,error:null}},computed:{historialFiltrado(){return this.historial.filter((o=>o.lecturacalidadactiva&&!o.lecturaempaquetadoactiva)).reverse()}},methods:{async registrarLectura(){this.loading=!0,this.error=null;try{const o=`http://192.168.1.33:8081/productos/${this.codigo}/empaquetado`,t={method:"PUT"},r=await fetch(o,t);if(!r.ok)throw new Error("Error al registrar la lectura de empaquetado");this.historial=this.historial.filter((o=>o.matricula!==this.codigo))}catch(o){this.error=o.message}finally{this.loading=!1,this.codigo=""}}},created(){this.socket=new WebSocket("ws://192.168.1.33:8081/ws"),this.socket.onopen=()=>{console.log("Conexión WebSocket establecida")},this.socket.onerror=o=>{console.error("Error en WebSocket:",o)},this.socket.onmessage=o=>{const t=JSON.parse(o.data);if(console.log("Mensaje recibido del WebSocket:",t),"update"===t.type){const o=this.historial.find((o=>o.matricula===t.producto.matricula));o||(this.historial.unshift(t.producto),this.historial.length>10&&this.historial.pop())}else"delete"===t.type&&(console.log("Producto a eliminar:",t.matricula),this.historial=this.historial.filter((o=>o.matricula!==t.matricula)),console.log("Producto eliminado del historial:",t.matricula))}}};const T=(0,l.A)(D,[["render",N],["__scopeId","data-v-46dabb30"]]);var I=T;const Q=[{path:"/calidad",name:"Calidad",component:_},{path:"/empaquetado",name:"Empaquetado",component:I}],$=(0,u.aE)({history:(0,u.LA)(),routes:Q});var x=$,F=r(834),U=r(4335);const q=(0,F.y$)({state:{datosProducto:null,loading:!1,error:null},mutations:{setDatosProducto(o,t){o.datosProducto=t},setLoading(o,t){o.loading=t},setError(o,t){o.error=t}},actions:{async updateDatosProducto({commit:o},t){o("setLoading",!0),o("setError",null);try{const r=await U.A.get(`http://192.168.1.33:8081/productos/of/${t}`);o("setDatosProducto",r.data)}catch(r){o("setError","Error al obtener los datos del producto")}finally{o("setLoading",!1)}},async registrarLecturaCalidad({commit:o},t){o("setLoading",!0),o("setError",null);try{const r=await U.A.put(`http://192.168.1.33:8081/productos/of/${t}/calidad`);o("setDatosProducto",r.data)}catch(r){o("setError","Error al registrar la lectura de calidad")}finally{o("setLoading",!1)}}}});var J=q;(0,a.Ef)(c).use(x).use(J).mount("#app")}},t={};function r(a){var i=t[a];if(void 0!==i)return i.exports;var e=t[a]={exports:{}};return o[a](e,e.exports,r),e.exports}r.m=o,function(){var o=[];r.O=function(t,a,i,e){if(!a){var n=1/0;for(u=0;u<o.length;u++){a=o[u][0],i=o[u][1],e=o[u][2];for(var l=!0,s=0;s<a.length;s++)(!1&e||n>=e)&&Object.keys(r.O).every((function(o){return r.O[o](a[s])}))?a.splice(s--,1):(l=!1,e<n&&(n=e));if(l){o.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}e=e||0;for(var u=o.length;u>0&&o[u-1][2]>e;u--)o[u]=o[u-1];o[u]=[a,i,e]}}(),function(){r.n=function(o){var t=o&&o.__esModule?function(){return o["default"]}:function(){return o};return r.d(t,{a:t}),t}}(),function(){r.d=function(o,t){for(var a in t)r.o(t,a)&&!r.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:t[a]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(o){if("object"===typeof window)return window}}()}(),function(){r.o=function(o,t){return Object.prototype.hasOwnProperty.call(o,t)}}(),function(){r.r=function(o){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})}}(),function(){r.p="/empaquetado/"}(),function(){var o={524:0};r.O.j=function(t){return 0===o[t]};var t=function(t,a){var i,e,n=a[0],l=a[1],s=a[2],c=0;if(n.some((function(t){return 0!==o[t]}))){for(i in l)r.o(l,i)&&(r.m[i]=l[i]);if(s)var u=s(r)}for(t&&t(a);c<n.length;c++)e=n[c],r.o(o,e)&&o[e]&&o[e][0](),o[e]=0;return r.O(u)},a=self["webpackChunkappcalidad"]=self["webpackChunkappcalidad"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=r.O(void 0,[504],(function(){return r(4600)}));a=r.O(a)})();
//# sourceMappingURL=app.566fe11b.js.map